applications:
  - grafana-operator
  - etcd as observer-etcd
  - mimir as observer-mimir

parameters:
  components:
    grafana-operator:
      url: https://github.com/tegridy-io/component-grafana-operator.git
      version: master
    etcd:
      url: https://github.com/projectsyn/component-etcd.git
      version: v0.1.0
    mimir:
      url: https://github.com/tegridy-io/component-mimir.git
      version: fix/ring-kvstore

  # --- Grafana Operator -------------------------------------------------------

  grafana_operator:
    namespace:
      name: efk-operator-grafana

    operator:
      grafana:
        enabled: true

  # --- Etcd -------------------------------------------------------------------

  observer_etcd:
    namespace: efk-observer-etcd
    # secrets:
    #   etcd-root-auth:
    #     stringData:
    #       password: '?{vaultkv:${cluster:tenant}/${cluster:name}/observer/etcd/rootPassword}'
    #   etcd-token-private-key:
    #     stringData:
    #       jwt-token.pem: '?{vaultkv:${cluster:tenant}/${cluster:name}/observer/etcd/tokenPrivkey}'

    helm_values:
      fullnameOverride: etcd
      autoCompactionMode: periodic
      autoCompactionRetention: 12h

      replicaCount: 3

      resources:
        requests:
          cpu: 100m
          memory: 400Mi
        limits:
          memory: 800Mi

      ~auth:
        rbac:
          create: false
          allowNoneAuthentication: true
        token:
          enabled: false
        client:
          secureTransport: false
          useAutoTLS: false
        peer:
          secureTransport: false
          useAutoTLS: false

      persistence:
        storageClass: ceph-block
        size: 2Gi

  # --- Mimir ------------------------------------------------------------------

  observer_mimir:
    namespace:
      name: efk-observer-mimir

    global:
      storageClass: ceph-block
      objectClass: ceph-bucket

    s3:
      region: eu-central-2
      endpoint: rook-ceph-rgw-ceph-objectstore.efk-storage-rook.svc
      insecure: true

    config:
      externalRing: false
      haTracker: true
      kvStore:
        endpoints:
          - https://etcd-0.etcd-headless.efk-observer-etcd.svc:2379
          - https://etcd-1.etcd-headless.efk-observer-etcd.svc:2379
          - https://etcd-2.etcd-headless.efk-observer-etcd.svc:2379

    helmValues:
      fullnameOverride: mimir
